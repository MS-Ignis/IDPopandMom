<!DOCTYPE html>
<meta charset="UTF-8">
<html>

<head>
    <title>Find Roll Number Mom And Pop</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <script type="text/javascript">

        function fn1() {
            var bits_id = document.getElementById("bits_id").value;

            var ids = [];
            var emails = [];
            var names = [];

            var ans_ids = [];
            var ans_emails = [];
            var ans_names = [];
            var ans_branch = [];
            var branch_codes = ['A1', 'A2', 'A3', 'A4', 'A5', 'A7', 'A8', 'AA', 'AB', 'B1', 'B2', 'B3', 'B4', 'B5'];
            var branch_names = ['Chemical', 'Civil', 'EEE', 'Mechanical', 'B. Pharma', 'Computer Science', 'EnI', 'ECE', 'Manufacturing', 'Msc. Bio', 'Msc. Chemistry', 'Msc. Eco', 'Msc. Math', 'Msc. Physics'];
            var ans_branch = [];

            $.ajax({
                url: 'mailingList_full.csv',
                dataType: 'text',
            }).done(successFunction);

            function successFunction(data) {
                rows = data.split('\n');
                ids = rows.map((row) => (row.split(','))[0]);
                emails = rows.map((row) => (row.split(','))[1]);
                names = rows.map((row) => (row.split(','))[2]);
                console.log(ids);
                console.log(emails);
                console.log(names);

                ids.forEach(element => {

                    if (element.includes(bits_id.slice(-5, -1))) {
                        idx = ids.indexOf(element);
                        ans_ids.push(ids[idx]);
                        ans_emails.push(emails[idx]);
                        ans_names.push(names[idx]);

                        branch_codes.forEach(code => {
                            if (element.includes(code)) {
                                idx_branch = branch_codes.indexOf(code);
                                ans_branch.push(branch_names[idx_branch]);
                            }
                        });
                    }
                });
                console.log(ans_ids);
                console.log(ans_names);
                console.log(ans_emails);
                console.log(ans_branch);

                for (let i = 0; i < ans_ids.length; i++) {
                    var parent = document.getElementById("parentlist");
                    var child = document.createElement('div');
                    
                    child.innerHTML = '<p class = "card-text">BITS ID: ' + ans_ids[i] + '</p>' +
                        '<p "card-title">Name: ' + ans_names[i] + '</p>' +
                        '<p "card-text">Branch: ' + ans_branch[i] + '</p>' +
                        '<p "card-text">Email: ' + ans_emails[i] + '</p>';
                    parent.appendChild(child);
                    child.classList.add("card");
                };
            }

            document.getElementById("parentlist").innerHTML = '';
        }
    </script>
</head>

<body>
    <div class = "page-header">
        <h1>Find Your ID Pop or ID Mom</h1>    
        <small>And maybe even ask them for a treat</small>
    </div>

    <div class = "form-group">
        <label>BITS ID</label>
        <input id="bits_id" class = "form-control" placeholder="Enter Your BITS Id">
        <small class = "form-text text-muted">Also maybe learn to give a formal intro lol</small>
    </div>
        <button onclick="fn1()" id="btn1" class="btn btn-primary" type = "button">Submit</button>
    <div id="parentlist"></div>

    <div class = "jumbotron">
        <p>Hope you found your mom and pop. Here's a blog I write. It would be great if you could check it out and drop a 	&#128079;</p>
        <a href = https://medium.com/@madhav-s/why-we-may-already-be-in-the-metaverse-679ba077bf75>Why We may already be in the metaverse</a>
    </div>
</body>
<script>
    var input = document.getElementById("bits_id");

    // Execute a function when the user releases a key on the keyboard
    input.addEventListener('keyup', function (event) {
        // Number 13 is the "Enter" key on the keyboard
        if (event.keyCode === 13) {
            // Cancel the default action, if needed
            event.preventDefault();
            fn1();
            // Trigger the button element with a click
            // document.getElementById("btn1").click();
        }
    });
</script>

</html>